<% content_for :title, "#{@player.full_name} (#{@player.position}) for #{@player.nfl_team}" %>
<% content_for :section_subtitle, "Player and contract information." %>

<div class="row">
	<div class="col-md-7">
		
		<% if @player.is_contracted? %>
			<p class="lead margin-bottom-2em"><span class="label label-danger"><i class="fa fa-check-square-o fa-lg"></i></span> Contracted to <%= link_to @player.this_year.team.team_name, @player.this_year.team %> as of <%= current_year %></p>
		<% else %>
			<p class="lead"><span class="label label-success">FA</span> Free agent as of <%= current_year %></p>
			<% if current_user %>
				<p class="lead margin-bottom-2em"><i class="fa fa-pencil-square-o"></i> <%= link_to "Add a contract for #{@player.full_name}", edit_player_path(@player) %></p>
					
			<% end %>
			
		<% end %>

		<% if @contracts.count > 0 %>
			<p class="h1">Contracts</p>
			
			<% @contracts.each do |contract| %>
					
					<% if contract == @player.current_contract %>
					<div class="panel panel-info margin-bottom-2em">
					<% else %>
					<div class="panel panel-default margin-bottom-2em">
					<% end %>
					<div class="panel-heading">
		          		
						<p class="panel-title bold">Contract started in <%= contract.contract_start_year %> for <%= contract.full_contract_length%> years
						<% if contract.is_extended %>
							<i class="fa fa-plus-circle"></i> 
						<% end %>

						<% if contract.is_franchised %>
							<i class="fa fa-tag"></i>
						<% end %>
						</p>
					</div>
					
					<table class="table table-striped table-condensed">
						<%= render "/contracts/contract_info_table", contract: contract %>

							

							<% if contract.is_bought_out %>
								<tr>
									<td></td>
									<td colspan="3"><span class="label label-danger"><i class="fa fa-exclamation-circle"></i></span> Contract bought out by 
										<%= link_to Team.find(contract.bought_out_by_team_id).team_name, Team.find(contract.bought_out_by_team_id) %>
									</td>
								</tr>
							<% end %>

							
									<tr>
										<td></td>
										<td colspan="3">
											<% if current_user %>
												<% if can? :manage, @player %>
													<i class="fa fa-pencil-square-o fa-lg"></i> <%= link_to "Edit this contract for #{@player.full_name}", edit_contract_path(contract) %> | 
												<% end %>
											<% end %> <%= link_to "View this contract", contract %>
										</td>
									</tr>
								

						</tbody>
					</table>
					
				</div>	
			<% end %>
			<%= render "/contracts/contract_clauses_key" %>
		
		<% end %>
		
	</div>
	<div class="col-md-5"><br />
		
		<% if @player.is_contracted? && !@player.this_year.contract.is_extended && !@player.this_year.contract.is_franchised %>
			<div class="bs-callout bs-callout-danger">
				<h4><i class="fa fa-plus-circle"></i> <%= @player.full_name %> is eligible for an extension</h4>
				<p>The next step in his salary progression is  <strong>$<%= @player.to_extend_now %></strong></p>
			</div>
		<% end %>
		<!--
		<% #if @player.is_contracted? %>
			<% #=link_to "#{@player.full_name}'s current contract", @player.current_contract %>
			<ul>
				<% #@player.current_contract.subcontracts.each do |sub| %>
					<li><%#= sub.contract_year %> for <%#= sub.salary_amount %> to <%#= sub.team.team_name %></li>
				<% #end %>
			</ul>
		<% #end %>
		-->
		
			<% if @player.is_contracted? && !@player.current_contract.is_franchised %> 
				<div class="bs-callout bs-callout-warning">
					<h4><i class="fa fa-tag"></i> <%= @player.full_name %> is eligible for a franchise tag</h4>
					
					<p><small class="muted">Top 5 <%= @player.position %>s based on current auction values</small></p>
					<ul>
					<% @top_5_players_of_position.each do |player| %>
						<li><%= link_to player.full_name, player %> for $<%= player.auction_value %>
					<% end %>
					</ul>
					<p>Averaged salaries: <strong>$<%= @top_5_average %></strong></p>
					<p>Salary progression + 1 year:  <strong>$<%= @next_step %></strong></p>
					<p>It will cost <strong>$<%= @franchise_cost %></strong> for <%= @player.full_name %>'s franchise year.</p>
					<% # if current_user.id == @player.this_year.team.user.id %>
					
					<% #end %>
				</div>
			<% end %>
		
	</div>
</div>